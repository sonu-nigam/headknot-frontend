services:
    app:
        build:
            context: .
            dockerfile: Dockerfile
        ports:
            - '3000:80'
        environment:
            - NODE_ENV=production
        restart: unless-stopped
        # Uncomment if you need to connect to a backend API running on host
        # extra_hosts:
        #   - "host.docker.internal:host-gateway"

    # Optional: Add a development service
    app-dev:
        image: node:20-alpine
        working_dir: /app
        volumes:
            - .:/app
            - /app/node_modules
        ports:
            - '5173:5173'
        command: sh -c "corepack enable && corepack prepare pnpm@10.4.1 --activate && pnpm install && pnpm dev -- --host"
        environment:
            - NODE_ENV=development
        profiles:
            - dev
